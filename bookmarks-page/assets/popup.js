import{u as N,r as a,j as e,R as B,a as C}from"./useBookmarks.js";function W(){const{bookmarks:o,loading:k,deleteBookmark:x,toggleWatched:j}=N(),[r,i]=a.useState(null),[n,l]=a.useState([]);a.useEffect(()=>{async function t(){try{const[s]=await chrome.tabs.query({active:!0,currentWindow:!0});if(s&&s.url){const c=new URL(s.url);if(c.hostname.includes("youtube.com")){const m=c.searchParams.get("v");if(m)i(m);else{const u=c.pathname.match(/\/shorts\/([a-zA-Z0-9_-]+)/);u&&i(u[1])}}}}catch(s){console.error("Error checking current tab:",s)}}t()},[]),a.useEffect(()=>{if(r&&o.length>0){const t=o.filter(s=>s.video_id===r);l(t)}else l([])},[r,o]);const p=n.length>0,d=n.some(t=>t.watched),v=async()=>{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(t)try{await chrome.tabs.sendMessage(t.id,{action:"trigger-bookmark"})}catch(s){console.error("Error adding bookmark:",s)}},g=async()=>{for(const t of n)await x(t.id)},b=async()=>{for(const t of n)await j(t.id)},w=async()=>{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(t)try{await chrome.tabs.sendMessage(t.id,{action:"trigger-sync-bookmark"})}catch(s){console.error("Error syncing bookmark:",s)}},y=()=>{chrome.tabs.create({url:chrome.runtime.getURL("bookmarks-page/index.html")})},f=t=>{chrome.tabs.create({url:t})},h=[...o].filter(t=>t.video_id!==r&&!t.watched).sort((t,s)=>new Date(s.created_at)-new Date(t.created_at)).slice(0,3);return e.jsxs("div",{className:"popup-container",children:[e.jsx("header",{className:"popup-header",children:e.jsx("h1",{children:"Marker"})}),r&&e.jsxs("section",{className:"current-video-section",children:[e.jsx("h2",{children:"Current Video"}),e.jsx("div",{className:"current-video-actions",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"action-btn remove-btn",onClick:g,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),"Remove"]}),e.jsxs("button",{className:"action-btn sync-btn",onClick:w,title:"Update bookmark to current timestamp",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),"Sync"]}),e.jsxs("button",{className:`action-btn watched-btn ${d?"is-watched":""}`,onClick:b,children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),d?"Watched":"Watched?"]})]}):e.jsxs("button",{className:"action-btn add-btn",onClick:v,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"14"}),e.jsx("line",{x1:"9",y1:"11",x2:"15",y2:"11"})]}),"Add Bookmark"]})})]}),e.jsxs("section",{className:"recent-section",children:[e.jsx("h2",{children:"Recent Bookmarks"}),k?e.jsx("div",{className:"empty-state",children:"Loading..."}):h.length===0?e.jsx("div",{className:"empty-state",children:o.length===0?"No bookmarks yet. Press Ctrl+Shift+L on a YouTube video!":"No other recent bookmarks"}):e.jsx("div",{className:"recent-list",children:h.map(t=>e.jsxs("div",{className:`recent-item ${t.watched?"watched":""}`,onClick:()=>f(t.video_url),children:[e.jsxs("div",{className:"recent-thumbnail",children:[e.jsx("img",{src:`https://img.youtube.com/vi/${t.video_id}/mqdefault.jpg`,alt:""}),e.jsx("span",{className:"timestamp-badge",children:t.timestamp_hh_mm_ss})]}),e.jsxs("div",{className:"recent-info",children:[e.jsx("div",{className:"recent-title",children:t.video_title}),e.jsx("div",{className:"recent-channel",children:t.channel_name})]})]},t.id))})]}),e.jsxs("button",{className:"view-all-btn",onClick:y,children:["View All Bookmarks",e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})]})]})}B.createRoot(document.getElementById("popup-root")).render(e.jsx(C.StrictMode,{children:e.jsx(W,{})}));
